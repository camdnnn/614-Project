@startuml SystemClassDiagram

skinparam classAttributeIconSize 0
hide circle
skinparam class {
    FontStyle bold
}

' Note: Getters/setters and constructors are omitted from entity classes as per project spec:
' "You don't need to show constructors/destructor, getters/setters."
package "Data Layer" {
  class DBConnection <<boundary>> {
    - {static} connection: Connection
    - {static} props: Properties
    + {static} getInstance(): Connection
    - {static} loadProperties(): void
    - {static} createConnection(): void
    - {static} getFirstNonBlank(primaryKey: String, fallbackKey: String): String
  }

  abstract class "Repository<T>" as Repository <<repository>> {
    + {abstract} create(data: T): void
    + {abstract} read(id: int): T
    + {abstract} update(id: int, data: T): void
    + {abstract} delete(id: int): void
    + {abstract} getAll(): List<T>
    # {abstract} mapRow(rs: ResultSet): T
  }

  class Booking <<entity>> {
    - id: int 
    - customerId: int
    - flightId: int
    - seatNumber: String
    - bookingDate: Date
    - status: String
  }

  class BookingRepository <<repository>> {
    + create(data: Booking): void
    + read(id: int): Booking
    + update(id: int, data: Booking): void
    + delete(id: int): void
    + getAll(): List<Booking>
    # mapRow(rs: ResultSet): Booking
  }

  class Flight <<entity>> {
    - id: int
    - airline: String
    - origin: String
    - destination: String
    - departure: Date
    - arrival: Date
    - price: float
    - availableSeats: int
  }

  class FlightRepository <<repository>> {
    + create(data: Flight): void
    + read(id: int): Flight
    + update(id: int, data: Flight): void
    + delete(id: int): void
    + getAll(): List<Flight>
    # mapRow(rs: ResultSet): Flight
  }

  class Payment <<entity>> {
    - id: int
    - customerId: int
    - bookingId: int
    - amount: float
    - paymentDate: Date
    - method: String
  }

  class PaymentRepository <<repository>> {
    + create(data: Payment): void
    + read(id: int): Payment
    + update(id: int, data: Payment): void
    + delete(id: int): void
    + getAll(): List<Payment>
    # mapRow(rs: ResultSet): Payment
  }

  enum Role {
    ADMIN
    AGENT
    CUSTOMER
  }

  class User <<entity>> {
    - id: int
    - name: String
    - email: String
    - password: String
    - role: Role
  }

  class UserRepository <<repository>> {
    + create(data: User): void
    + read(id: int): User
    + update(id: int, data: User): void
    + delete(id: int): void
    + getAll(): List<User>
    # mapRow(rs: ResultSet): User
  }

  class MonthlyNews <<entity>> {
    - id: int
    - title: String
    - content: String
    - publishDate: Date
  }

  class MonthlyNewsRepository <<repository>> {
    + create(data: MonthlyNews): void
    + read(id: int): MonthlyNews
    + update(id: int, data: MonthlyNews): void
    + delete(id: int): void
    + getAll(): List<MonthlyNews>
    # mapRow(rs: ResultSet): MonthlyNews
  }

  MonthlyNewsRepository --|> Repository
  MonthlyNewsRepository -> MonthlyNews
  BookingRepository --|> Repository
  BookingRepository -> Booking
  FlightRepository --|> Repository
  FlightRepository -> Flight
  PaymentRepository --|> Repository
  PaymentRepository -> Payment 
  UserRepository --|> Repository
  UserRepository -> User

  BookingRepository --> DBConnection : uses
  FlightRepository --> DBConnection : uses
  PaymentRepository --> DBConnection : uses
  UserRepository --> DBConnection : uses
  MonthlyNewsRepository --> DBConnection : uses
}

package "Presentation Layer" {
  class LoginView <<boundary>> {
    - frame: JFrame
    - usernameField: JTextField
    - passwordField: JPasswordField
    - loginButton: JButton
    - errorLabel: JLabel
    + display(): void
    + dispose(): void
    + getUsername(): String
    + getPassword(): String
    + showError(message: String): void
    + clearFields(): void
    + addLoginListener(listener: ActionListener): void
  }

  ' As per Marking Sheet for Project Implementation screenshot:
  ' "Your GUI should start with options of running the program as Customer, Agent or Admin."
  class RoleSelectionView <<boundary>> {
    - frame: JFrame
    - titleLabel: JLabel
    - customerButton: JButton
    - agentButton: JButton
    - adminButton: JButton
    - backButton: JButton
    + display(): void
    + dispose(): void
    + addCustomerListener(listener: ActionListener): void
    + addAgentListener(listener: ActionListener): void
    + addAdminListener(listener: ActionListener): void
    + addBackListener(listener: ActionListener): void
  }

  ' Design Decision: Using separate menu views per role instead of a single MainMenuView
  ' with role-based conditional logic. This approach keeps each view simple (single responsibility),
  ' avoids putting business logic in the view layer, and provides clearer traceability
  ' from use cases to specific UI components. The minor code duplication is acceptable
  ' for better separation of concerns and cleaner architecture documentation.
  class CustomerMenuView <<boundary>> {
    - frame: JFrame
    - searchFlightsButton: JButton
    - viewBookingsButton: JButton
    - viewPaymentsButton: JButton
    - viewNewsButton: JButton
    - logoutButton: JButton
    + display(): void
    + dispose(): void
    + addSearchFlightsListener(listener: ActionListener): void
    + addViewBookingsListener(listener: ActionListener): void
    + addViewPaymentsListener(listener: ActionListener): void
    + addViewNewsListener(listener: ActionListener): void
    + addLogoutListener(listener: ActionListener): void
  }

  class AgentMenuView <<boundary>> {
    - frame: JFrame
    - manageBookingsButton: JButton
    - manageCustomersButton: JButton
    - viewFlightsButton: JButton
    - viewPaymentsButton: JButton
    - logoutButton: JButton
    + display(): void
    + dispose(): void
    + addManageBookingsListener(listener: ActionListener): void
    + addManageCustomersListener(listener: ActionListener): void
    + addViewFlightsListener(listener: ActionListener): void
    + addViewPaymentsListener(listener: ActionListener): void
    + addLogoutListener(listener: ActionListener): void
  }

  class AdminMenuView <<boundary>> {
    - frame: JFrame
    - manageFlightsButton: JButton
    - viewFlightsButton: JButton
    - logoutButton: JButton
    + display(): void
    + dispose(): void
    + addManageFlightsListener(listener: ActionListener): void
    + addViewFlightsListener(listener: ActionListener): void
    + addLogoutListener(listener: ActionListener): void
  }

  class FlightSearchView <<boundary>> {
    - frame: JFrame
    - originField: JTextField
    - destinationField: JTextField
    - departureDateField: JTextField
    - airlineComboBox: JComboBox
    - searchButton: JButton
    - clearButton: JButton
    - backButton: JButton
    + display(): void
    + dispose(): void
    + getOrigin(): String
    + getDestination(): String
    + getDepartureDate(): String
    + getSelectedAirline(): String
    + clearFields(): void
    + addSearchListener(listener: ActionListener): void
    + addClearListener(listener: ActionListener): void
    + addBackListener(listener: ActionListener): void
  }

  class FlightResultsView <<boundary>> {
    - frame: JFrame
    - flightsTable: JTable
    - tableModel: DefaultTableModel
    - selectButton: JButton
    - backButton: JButton
    - noResultsLabel: JLabel
    + display(): void
    + dispose(): void
    + displayFlights(flights: List<Flight>): void
    + getSelectedRowIndex(): int
    + showNoResults(): void
    + addSelectListener(listener: ActionListener): void
    + addBackListener(listener: ActionListener): void
  }

  class BookingView <<boundary>> {
    - frame: JFrame
    - flightDetailsPanel: JPanel
    - seatComboBox: JComboBox
    - passengerNameField: JTextField
    - passengerEmailField: JTextField
    - bookButton: JButton
    - cancelButton: JButton
    - modifyButton: JButton
    - backButton: JButton
    + display(): void
    + dispose(): void
    + displayFlightDetails(flight: Flight): void
    + displayBookingDetails(booking: Booking): void
    + getSeatSelection(): String
    + getPassengerName(): String
    + getPassengerEmail(): String
    + addBookListener(listener: ActionListener): void
    + addCancelListener(listener: ActionListener): void
    + addModifyListener(listener: ActionListener): void
    + addBackListener(listener: ActionListener): void
  }

  class BookingConfirmationView <<boundary>> {
    - frame: JFrame
    - confirmationPanel: JPanel
    - confirmationNumberLabel: JLabel
    - flightInfoLabel: JLabel
    - passengerInfoLabel: JLabel
    - seatInfoLabel: JLabel
    - statusLabel: JLabel
    - printButton: JButton
    - doneButton: JButton
    + display(): void
    + dispose(): void
    + displayConfirmation(booking: Booking, flight: Flight): void
    + setConfirmationNumber(number: String): void
    + addPrintListener(listener: ActionListener): void
    + addDoneListener(listener: ActionListener): void
  }

  ' Controller logic determines which bookings to display:
  ' - Customer: shows only their own bookings (filtered by customerId)
  ' - Agent: shows all customer bookings (no filter)
  class BookingHistoryView <<boundary>> {
    - frame: JFrame
    - bookingsTable: JTable
    - tableModel: DefaultTableModel
    - viewDetailsButton: JButton
    - cancelBookingButton: JButton
    - modifyBookingButton: JButton
    - backButton: JButton
    + display(): void
    + dispose(): void
    + displayBookings(bookings: List<Booking>): void
    + getSelectedBooking(): Booking
    + refreshTable(): void
    + addViewDetailsListener(listener: ActionListener): void
    + addCancelBookingListener(listener: ActionListener): void
    + addModifyBookingListener(listener: ActionListener): void
    + addBackListener(listener: ActionListener): void
  }

  class PaymentView <<boundary>> {
    - frame: JFrame
    - amountLabel: JLabel
    - cardNumberField: JTextField
    - cardHolderField: JTextField
    - expiryDateField: JTextField
    - cvvField: JPasswordField
    - payButton: JButton
    - cancelButton: JButton
    - statusLabel: JLabel
    + display(): void
    + dispose(): void
    + displayAmount(amount: float): void
    + getCardNumber(): String
    + getCardHolder(): String
    + getExpiryDate(): String
    + getCvv(): String
    + showSuccess(): void
    + showError(message: String): void
    + clearFields(): void
    + addPayListener(listener: ActionListener): void
    + addCancelListener(listener: ActionListener): void
  }

  ' Controller logic determines which payments to display:
  ' - Customer: shows only their own payment history (filtered by customerId)
  ' - Agent: shows all customer payment history (no filter)
  class PaymentHistoryView <<boundary>> {
    - frame: JFrame
    - paymentsTable: JTable
    - tableModel: DefaultTableModel
    - viewDetailsButton: JButton
    - backButton: JButton
    + display(): void
    + dispose(): void
    + displayPayments(payments: List<Payment>): void
    + getSelectedPayment(): Payment
    + addViewDetailsListener(listener: ActionListener): void
    + addBackListener(listener: ActionListener): void
  }

  class CustomerProfileView <<boundary>> {
    - frame: JFrame
    - searchField: JTextField
    - searchButton: JButton
    - customersTable: JTable
    - tableModel: DefaultTableModel
    - nameField: JTextField
    - emailField: JTextField
    - passwordField: JTextField
    - addButton: JButton
    - updateButton: JButton
    - clearButton: JButton
    - backButton: JButton
    + display(): void
    + dispose(): void
    + displayCustomers(customers: List<User>): void
    + displayCustomerDetails(customer: User): void
    + getSearchQuery(): String
    + getCustomerName(): String
    + getCustomerEmail(): String
    + getCustomerPassword(): String
    + getSelectedCustomer(): User
    + clearFields(): void
    + addSearchListener(listener: ActionListener): void
    + addAddListener(listener: ActionListener): void
    + addUpdateListener(listener: ActionListener): void
    + addClearListener(listener: ActionListener): void
    + addBackListener(listener: ActionListener): void
  }

  class FlightManagementView <<boundary>> {
    - frame: JFrame
    - flightsTable: JTable
    - tableModel: DefaultTableModel
    - flightIdField: JTextField
    - airlineField: JTextField
    - originField: JTextField
    - destinationField: JTextField
    - departureDateField: JTextField
    - arrivalDateField: JTextField
    - priceField: JTextField
    - seatsField: JTextField
    - addButton: JButton
    - updateButton: JButton
    - removeButton: JButton
    - clearButton: JButton
    - backButton: JButton
    - editingEnabled: boolean
    + display(): void
    + dispose(): void
    + displayFlights(flights: List<Flight>): void
    + getFlightId(): String
    + getAirline(): String
    + getOrigin(): String
    + getDestination(): String
    + getDepartureDate(): String
    + getArrivalDate(): String
    + getPrice(): String
    + getSeats(): String
    + getSelectedFlight(): Flight
    + clearFields(): void
    + setEditingEnabled(enabled: boolean): void
    + addAddListener(listener: ActionListener): void
    + addUpdateListener(listener: ActionListener): void
    + addRemoveListener(listener: ActionListener): void
    + addClearListener(listener: ActionListener): void
    + addBackListener(listener: ActionListener): void
  }

  class MonthlyNewsView <<boundary>> {
    - frame: JFrame
    - newsPanel: JPanel
    - newsContentArea: JTextArea
    - titleLabel: JLabel
    - dateLabel: JLabel
    - backButton: JButton
    - refreshButton: JButton
    + display(): void
    + dispose(): void
    + displayNews(news: MonthlyNews): void
    + clearNews(): void
    + addBackListener(listener: ActionListener): void
    + addRefreshListener(listener: ActionListener): void
  }

  ' UiController is the main presentation controller that wires views to services
  class UiController <<control>> {
    - authService: AuthService
    - newsService: NewsService
    - flightService: FlightService
    - bookingService: BookingService
    - paymentService: PaymentService
    - userService: UserService
    - currentUser: User
    - lastFlights: List<Flight>
    - loginView: LoginView
    - customerMenuView: CustomerMenuView
    - agentMenuView: AgentMenuView
    - adminMenuView: AdminMenuView
    - flightSearchView: FlightSearchView
    - flightResultsView: FlightResultsView
    - bookingView: BookingView
    - paymentView: PaymentView
    - newsView: MonthlyNewsView
    - confirmationView: BookingConfirmationView
    - bookingHistoryView: BookingHistoryView
    - paymentHistoryView: PaymentHistoryView
    - flightManagementView: FlightManagementView
    - customerProfileView: CustomerProfileView
    - roleSelectionView: RoleSelectionView
    + start(): void
  }

  ' Navigation relationships
  LoginView --> RoleSelectionView : navigates to
  RoleSelectionView --> CustomerMenuView : selects Customer
  RoleSelectionView --> AgentMenuView : selects Agent
  RoleSelectionView --> AdminMenuView : selects Admin

  ' Customer flow
  CustomerMenuView --> FlightSearchView : navigates to
  CustomerMenuView --> BookingHistoryView : navigates to
  CustomerMenuView --> PaymentHistoryView : navigates to
  CustomerMenuView --> MonthlyNewsView : navigates to
  FlightSearchView --> FlightResultsView : navigates to
  FlightResultsView --> BookingView : navigates to
  BookingView --> PaymentView : navigates to
  PaymentView --> BookingConfirmationView : navigates to
  BookingHistoryView --> BookingView : navigates to

  ' Agent flow
  AgentMenuView --> BookingHistoryView : navigates to
  AgentMenuView --> CustomerProfileView : navigates to
  AgentMenuView --> FlightResultsView : navigates to
  AgentMenuView --> PaymentHistoryView : navigates to

  ' Admin flow
  AdminMenuView --> FlightManagementView : navigates to
  AdminMenuView --> FlightResultsView : navigates to
}

package "Business Logic Layer" {

  ' AppController centralizes interactions from Presentation -> BLL
  class AppController <<Singleton>> {
    - {static} instance: AppController
    - paymentService: PaymentService
    - bookingService: BookingService
    - flightService: FlightService
    - userService: UserService
    + {static} init(paymentService: PaymentService, bookingService: BookingService, flightService: FlightService, userService: UserService): AppController
    + {static} getInstance(): AppController
    + payForBooking(payment: Payment): Payment
    + getBooking(bookingId: int): Booking
    + getAllBookings(): List<Booking>
    + getAllFlights(): List<Flight>
    + addFlight(flight: Flight): void
    + updateFlight(id: int, flight: Flight): void
    + removeFlight(id: int): void
    + getAllUsers(): List<User>
    + createUser(user: User): void
    + updateUser(id: int, user: User): void
    + deleteUser(id: int): void
  }

  ' -----------------------------
  ' Authentication / User Logic
  ' -----------------------------
  class AuthService <<control>> {
    - userRepository: Repository<User>
    + login(email: String, password: String): User
    + verifyRole(user: User, requiredRole: Role): boolean
  }

  class UserService <<control>> {
    - userRepository: Repository<User>
    + getAllUsers(): List<User>
    + getUser(id: int): User
    + createUser(user: User): void
    + updateUser(id: int, user: User): void
    + deleteUser(id: int): void
  }


  ' -----------------------------
  ' Flight Logic
  ' -----------------------------
  class FlightService <<control>> {
    - flightRepository: Repository<Flight>
    + getAllFlights(): List<Flight>
    + getFlight(id: int): Flight
    + addFlight(flight: Flight): void
    + updateFlight(id: int, flight: Flight): void
    + removeFlight(id: int): void
  }


  ' -----------------------------
  ' Booking Logic
  ' -----------------------------
  class BookingService <<control>> {
    - bookingRepository: Repository<Booking>
    + getBookingById(bookingId: int): Booking
    + getAllBookings(): List<Booking>
    + addBooking(booking: Booking): void
    + updateBooking(id: int, booking: Booking): void
    + deleteBooking(id: int): void
    + markPaid(bookingId: int): void
  }


  ' -----------------------------
  ' Payment Logic
  ' -----------------------------
  class PaymentService <<control>> {
    - paymentRepository: Repository<Payment>
    - bookingService: BookingService
    + recordPayment(payment: Payment): Payment
    + getPayment(id: int): Payment
    + getAllPayments(): List<Payment>
  }


  ' -----------------------------
  ' News Logic (Static Content)
  ' -----------------------------
  class NewsService <<control>> {
    - newsRepository: Repository<MonthlyNews>
    - cachedNews: MonthlyNews
    + getMonthlyNews(): MonthlyNews
    + refreshNews(): void
  }

  ' -----------------------------
  ' Dependencies (BLL â†’ Data Layer)
  ' -----------------------------
  AuthService --> UserRepository : queries
  UserService --> UserRepository : queries

  FlightService --> FlightRepository : queries

  BookingService --> BookingRepository : queries

  PaymentService --> PaymentRepository : queries
  PaymentService --> BookingService : calls to

  NewsService --> MonthlyNewsRepository : queries

  ' -----------------------------
  ' App Controller Dependencies
  ' -----------------------------
  AppController *-- PaymentService
  AppController *-- BookingService
  AppController *-- FlightService
  AppController *-- UserService

  ' -----------------------------
  ' UiController Dependencies
  ' -----------------------------
  UiController *-- AuthService
  UiController *-- NewsService
  UiController *-- FlightService
  UiController *-- BookingService
  UiController *-- PaymentService
  UiController *-- UserService
  
  UiController --> LoginView : manages
  UiController --> RoleSelectionView : manages
  UiController --> CustomerMenuView : manages
  UiController --> AgentMenuView : manages
  UiController --> AdminMenuView : manages
  UiController --> MonthlyNewsView : manages
  UiController --> BookingHistoryView : manages
  UiController --> FlightSearchView : manages
  UiController --> PaymentHistoryView : manages
  UiController --> FlightResultsView : manages
  UiController --> CustomerProfileView : manages
  UiController --> FlightManagementView : manages
  UiController --> BookingView : manages
  UiController --> BookingConfirmationView : manages
  UiController --> PaymentView : manages
  
}

@enduml
